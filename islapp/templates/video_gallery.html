{% extends 'base.html' %}
{% load static %}
{% block title %}Indian Sign Language Arena - Gesture Library{% endblock %}
{% block content %}
<div class="container-fluid py-5">
    <!-- Page Header -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="p-4 rounded shadow-sm bg-light border border-secondary-subtle">
                <div class="d-sm-flex align-items-center justify-content-between">
                    <div>
                        <h2 class="fw-bold display-6 mb-1 text-primary">ðŸŽ¥ Gesture Video Library</h2>
                        <p class="fs-5 text-muted mb-0">Browse and learn Indian Sign Language gestures by category</p>
                    </div>
                    <div class="mt-3 mt-sm-0">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb bg-transparent mb-0">
                                <li class="breadcrumb-item active text-primary" aria-current="page">Gesture Gallery</li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    <!-- Video Player Section -->
    <div class="row mb-5">
        <div class="col-lg-10 col-xl-8 mx-auto">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-0">
                    <div id="video-player" class="bg-light rounded p-3">
                        <div class="ratio ratio-16x9">
                            <video id="main-video" controls style="display: none;">
                                <source id="main-source" src="" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <div id="video-placeholder" class="d-flex flex-column align-items-center justify-content-center bg-light-primary">
                                <iconify-icon icon="solar:play-circle-outline" class="fs-10 text-primary mb-3"></iconify-icon>
                                <h4 class="text-dark fs-4 fw-semibold">Select a gesture to start learning</h4>
                                <p class="text-muted mb-0">Click on any play button below to view the corresponding sign language gesture</p>
                            </div>
                        </div>
                    </div>
                    <div id="video-info" class="p-4 border-top" style="display: none;">
                        <h3 id="current-gesture" class="fs-5 fw-semibold mb-1">Gesture Name</h3>
                        <p id="current-description" class="text-muted mb-0">Gesture type and additional information will appear here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Tabs -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <ul class="nav nav-tabs nav-tabs-custom nav-justified" id="gesture-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="all-tab" data-bs-toggle="tab" href="#all" role="tab">
                                <span class="d-block d-sm-none"><iconify-icon icon="solar:grid-linear"></iconify-icon></span>
                                <span class="d-none d-sm-block">All Gestures</span>
                            </a>
                        </li>
                        {% regroup videos by gesture_type as type_list %}
                        {% for type in type_list %}
                        <li class="nav-item">
                            <a class="nav-link" id="tab-{{ type.grouper|slugify }}" data-bs-toggle="tab" href="#type-{{ type.grouper|slugify }}" role="tab">
                                <span class="d-block d-sm-none"><iconify-icon icon="solar:hand-linear"></iconify-icon></span>
                                <span class="d-none d-sm-block">{{ type.grouper }}</span>
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Gesture Tables by Category -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="tab-content" id="gesture-content">
                        <!-- All Gestures Tab -->
                        <div class="tab-pane fade show active" id="all" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-hover table-primary">
                                    <thead class="bg-primary text-white">
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Gesture</th>
                                            <th scope="col">Type</th>
                                            <th scope="col" class="text-center">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for video in videos %}
                                        <tr>
                                            <th scope="row">{{ forloop.counter }}</th>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="rounded-circle bg-light-{{ forloop.counter|divisibleby:4|yesno:'primary,success,warning,danger' }} p-2 me-3">
                                                        <iconify-icon icon="solar:hand-linear" class="fs-5 text-{{ forloop.counter|divisibleby:4|yesno:'primary,success,warning,danger' }}"></iconify-icon>
                                                    </div>
                                                    <div>
                                                        <h6 class="mb-0 fw-semibold">{{ video.gesture }}</h6>
                                                    </div>
                                                </div>
                                            </td>
                                            <td><span class="badge bg-light-{{ forloop.counter|divisibleby:4|yesno:'primary,success,warning,danger' }} text-{{ forloop.counter|divisibleby:4|yesno:'primary,success,warning,danger' }} rounded-pill px-3 py-2">{{ video.gesture_type }}</span></td>
                                            <td class="text-center">
                                                <button class="btn btn-primary btn-sm rounded-pill" onclick="playVideo('{{ video.video_file.url }}', '{{ video.gesture }}', '{{ video.gesture_type }}')">
                                                    <iconify-icon icon="solar:play-circle-bold" class="me-1"></iconify-icon> Play
                                                </button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Category Specific Tabs -->
                        {% for type in type_list %}
                        <div class="tab-pane fade" id="type-{{ type.grouper|slugify }}" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-hover table-primary">
                                    <thead class="bg-primary text-white">
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Gesture</th>
                                            <th scope="col">Type</th>
                                            <th scope="col" class="text-center">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for video in type.list %}
                                        <tr>
                                            <th scope="row">{{ forloop.counter }}</th>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="rounded-circle bg-light-{{ forloop.counter|divisibleby:4|yesno:'primary,success,warning,danger' }} p-2 me-3">
                                                        <iconify-icon icon="solar:hand-linear" class="fs-5 text-{{ forloop.counter|divisibleby:4|yesno:'primary,success,warning,danger' }}"></iconify-icon>
                                                    </div>
                                                    <div>
                                                        <h6 class="mb-0 fw-semibold">{{ video.gesture }}</h6>
                                                    </div>
                                                </div>
                                                <td><span class="badge bg-light-{{ forloop.counter|divisibleby:4|yesno:'primary,success,warning,danger' }} text-{{ forloop.counter|divisibleby:4|yesno:'primary,success,warning,danger' }} rounded-pill px-3 py-2">{{ video.gesture_type }}</span></td>
                                            </td>
                                            <td class="text-center">
                                                <button class="btn btn-primary btn-sm rounded-pill" onclick="playVideo('{{ video.video_file.url }}', '{{ video.gesture }}', '{{ video.gesture_type }}')">
                                                    <iconify-icon icon="solar:play-circle-bold" class="me-1"></iconify-icon> Play
                                                </button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Practice Section -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card bg-primary border-0">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-lg-8">
                            <h3 class="text-white mb-3">Ready to practice these gestures?</h3>
                            <p class="text-white-50 mb-lg-0 mb-3">Use our interactive practice tool to receive real-time feedback on your sign language gestures.</p>
                        </div>
                        <div class="col-lg-4 text-lg-end">
                            <a href="#" class="btn btn-light rounded-pill fw-semibold px-4">
                                <iconify-icon icon="solar:videocamera-record-bold" class="me-2"></iconify-icon> Start Practice Session
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced JavaScript for video player -->
<script>
function playVideo(videoUrl, gestureName, gestureType) {
    const video = document.getElementById('main-video');
    const source = document.getElementById('main-source');
    const placeholder = document.getElementById('video-placeholder');
    const videoInfo = document.getElementById('video-info');
    const currentGesture = document.getElementById('current-gesture');
    const currentDescription = document.getElementById('current-description');
    
    // Update video source
    source.src = videoUrl;
    video.load();
    
    // Update info
    currentGesture.textContent = gestureName;
    currentDescription.textContent = "Gesture Type: " + gestureType;
    
    // Show video and info, hide placeholder
    video.style.display = 'block';
    videoInfo.style.display = 'block';
    placeholder.style.display = 'none';
    
    // Empty out placeholder text (even though it's hidden)
    placeholder.innerHTML = '';
    
    // Auto-scroll to video if not in view
    video.scrollIntoView({behavior: 'smooth', block: 'nearest'});
    
    // Play video
    video.play();
}

// Handle video end event
document.getElementById('main-video').addEventListener('ended', function() {
    // You could add effects here like showing a replay button
    // or other feedback when video ends
});
</script>
{% endblock %}